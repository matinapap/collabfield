<% conversation = @conversation %>
<% user = current_user %>

<% if conversation.present? %>
  <%= render 'private/conversations/conversation', conversation: conversation, user: user %>
  
  <script>
    var conversationId = "<%= @conversation.id %>";
    var chat_windows_count = $('.conversation-window').length + 1;

    var conversation = $('body').find("[data-pconversation-id='" + conversationId + "']");

    if (conversation.length !== 1) {

      $('body').append("<%= j(render 'private/conversations/conversation', conversation: @conversation, user: current_user) %>");
      conversation = $('body').find("[data-pconversation-id='" + conversationId + "']");
    }

    $('.conversation-window:nth-of-type(' + chat_windows_count + ') .conversation-heading').click();

    setTimeout(function() {
      $('.conversation-window:nth-of-type(' + chat_windows_count + ')').click();
    }, 1000);
    $('.conversation-window:nth-of-type(' + chat_windows_count + ') form textarea').focus();

    positionChatWindows();
  </script>
<% end %>
